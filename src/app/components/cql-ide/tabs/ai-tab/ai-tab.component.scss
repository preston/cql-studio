// Import IDE theme variables
@use '../../styles/ide-theme.scss' as theme;

// AI Tab Container
:host {
  display: flex;
  flex-direction: column;
  height: 100%;
  
  // Force white text on dark background for assistant messages only
  .assistant-message * {
    color: theme.$ide-text-white !important;
  }
  
  // Override Bootstrap classes
  .text-muted, .text-light, .text-white-50 {
    color: theme.$ide-text-white !important;
  }
  
  .alert {
    background-color: theme.$ide-bg-secondary !important;
    border-color: theme.$ide-border !important;
    color: theme.$ide-text-white !important;
  }
}

.ai-tab-container {
  background-color: theme.$ide-bg-primary !important;
  display: flex;
  flex-direction: column;
  height: 100%;
  
  // Fixed Toolbar
  .ai-toolbar {
    position: sticky;
    top: 0;
    z-index: 1000;
    background-color: theme.$ide-bg-secondary;
    border-bottom: 1px solid theme.$ide-border;
    min-height: 48px;
    flex-shrink: 0; // Prevent toolbar from shrinking
    
    // Context indicators
    .context-indicator {
      .badge {
        font-size: 0.75rem;
        padding: 0.375rem 0.75rem;
        border-radius: 0.375rem;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        background-color: theme.$ide-blue !important;
        color: white !important;
      }
    }
    
    // Context history dropdown
    .dropdown-menu {
      max-height: 300px;
      overflow-y: auto;
      background-color: theme.$ide-bg-secondary;
      border-color: theme.$ide-border;
      
      .dropdown-item {
        padding: 0.5rem 1rem;
        color: theme.$ide-text-white;
        
        &:hover {
          background-color: rgba(255, 255, 255, 0.1);
          color: theme.$ide-text-white;
        }
        
        &.active {
          background-color: rgba(255, 255, 255, 0.2);
          color: theme.$ide-text-white;
        }
        
        .text-muted {
          color: theme.$ide-text-primary !important;
        }
      }
    }
  }
  
  // Main Chat Area
  .ai-chat-area {
    // Bootstrap flex-fill handles the flex: 1
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 0; // Allow flex item to shrink below content size
    
    // Messages Output Area
    .messages-area {
      overflow-y: auto;
      overflow-x: hidden;
      background-color: theme.$ide-bg-primary;
      color: theme.$ide-text-white;
      flex: 1;
      padding-bottom: 0;
      
      // Auto-scroll to bottom
      scroll-behavior: smooth;
    }
      
    // Code blocks
    .code-block {
      margin-top: 12px;
      
      pre {
        margin: 0;
        font-size: 0.875rem;
        line-height: 1.4;
        background-color: theme.$ide-bg-secondary;
        color: theme.$ide-text-white;
        border: 1px solid theme.$ide-border;
        border-radius: 4px;
        padding: 12px;
      }
    }
    
    // Welcome message
    .welcome-message {
      height: 100%;
      background-color: theme.$ide-bg-primary;
      
      .suggested-commands {
        .suggested-command-btn {
          max-width: 300px;
          white-space: normal;
          text-align: left;
          line-height: 1.3;
          padding: 8px 12px;
          border-radius: 6px;
          transition: all 0.2s ease;
          
          &:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.2);
          }
        }
      }
    }
    
    // Fixed Input Area
    .ai-input-area {
      position: sticky;
      bottom: 0;
      z-index: 1000;
      flex-shrink: 0;
      background-color: theme.$ide-bg-secondary;
      border-top: 1px solid theme.$ide-border;
      
      .input-group {
        .form-control {
          background-color: theme.$ide-bg-secondary;
          border-color: theme.$ide-border;
          color: theme.$ide-text-white;
          border-right: none;
          
          &:focus {
            background-color: theme.$ide-bg-secondary;
            border-color: theme.$ide-blue;
            color: theme.$ide-text-white;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
          }
        }
        
        .btn {
          border-left: none;
        }
      }
    }
  }
  
  // AI Not Available
  .ai-not-available {
    background-color: theme.$ide-bg-primary;
    
    .connection-test {
      background-color: theme.$ide-bg-secondary;
      border: 1px solid theme.$ide-border;
    }
  }
}

// Streaming cursor animation
.streaming-cursor {
  span {
    animation: blink 1s infinite;
  }
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}

// Minimal markdown styling for chat - use ::ng-deep to penetrate component encapsulation
:host ::ng-deep .ai-tab-container markdown {
  h1, h2, h3, h4, h5, h6 {
    color: theme.$ide-text-white !important;
    font-size: 0.8rem;
    font-weight: 600;
    margin: 0.2rem 0 0.1rem 0;
  }
  
  p {
    color: theme.$ide-text-white !important;
    margin-bottom: 0.2rem;
    font-size: 0.85rem;
  }
  
  ul, ol {
    color: theme.$ide-text-white !important;
    margin-bottom: 0.2rem;
    padding-left: 1rem;
    font-size: 0.85rem;
  }
  
  a {
    color: theme.$ide-blue !important;
  }
  
  code {
    background-color: theme.$ide-bg-secondary;
    color: theme.$ide-text-white;
    padding: 0.1rem 0.2rem;
    border-radius: 2px;
    font-size: 0.75rem;
  }
}

// Assistant message styling
.ai-tab-container {
  .ai-chat-area {
    .messages-area {
      .message {
        &.assistant-message .message-content .message-body {
          background-color: transparent;
          color: theme.$ide-text-white;
          border: none;
        }
      }
      
      .welcome-message {
        h5, h6 {
          color: theme.$ide-text-white !important;
        }
        
        p, span {
          color: theme.$ide-text-primary !important;
        }
      }
    }
  }
  
  .ai-not-available {
    h5, h6 {
      color: theme.$ide-text-white !important;
    }
    
    p, span, small {
      color: theme.$ide-text-primary !important;
    }
  }
}

// Responsive design
@media (max-width: 768px) {
  .ai-tab-container {
    .ai-toolbar {
      .d-flex {
        flex-direction: column;
        gap: 8px;
      }
    }
    
    .ai-chat-area {
      .messages-area {
        padding: 16px 12px;
      }
      
      .ai-input-area {
        padding: 12px;
        
        .input-group {
          .form-control {
            font-size: 0.9rem;
          }
        }
      }
    }
  }
}