<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <h1 class="mb-4">Launching CQL Test Results Viewer</h1>
    </div>
  </div>
  
  <div class="row">
    <!-- Vertical Tabs Navigation -->
    <div class="col-md-3">
      <div class="nav flex-column nav-pills documentation-nav" role="tablist">
        <button 
          id="query-parameters-tab"
          class="nav-link" 
          [class.active]="activeTab === 'query-parameters'"
          (click)="setActiveTab('query-parameters')"
          type="button">
          Query Parameters
        </button>
        <button 
          id="index-files-tab"
          class="nav-link" 
          [class.active]="activeTab === 'index-files'"
          (click)="setActiveTab('index-files')"
          type="button">
          Index File Support
        </button>
        <button 
          id="integration-tab"
          class="nav-link" 
          [class.active]="activeTab === 'integration'"
          (click)="setActiveTab('integration')"
          type="button">
          Integration & Deep Linking
        </button>
        <button 
          id="validation-tab"
          class="nav-link" 
          [class.active]="activeTab === 'validation'"
          (click)="setActiveTab('validation')"
          type="button">
          Schema Validation
        </button>
        <button 
          id="filtering-tab"
          class="nav-link" 
          [class.active]="activeTab === 'filtering'"
          (click)="setActiveTab('filtering')"
          type="button">
          Filtering & Organization
        </button>
      </div>
    </div>

    <!-- Tab Content -->
    <div class="col-md-9">
      <div class="tab-content">
        
        <!-- Query Parameters Tab -->
        <div class="tab-pane" [class.active]="activeTab === 'query-parameters'">
          <div class="card">
            <div class="card-header">
              <h2 class="h4 mb-0">Query Parameters</h2>
            </div>
            <div class="card-body">
              <p class="lead">The application supports advanced query parameters for programmatic access and deep linking to
                specific filtered views.</p>

              <h3>Supported Parameters</h3>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Parameter</th>
                    <th>Description</th>
                    <th>Values</th>
                    <th>Example</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><code>url</code></td>
                    <td>URL to a JSON results file</td>
                    <td>Valid HTTP/HTTPS URL</td>
                    <td><code>?url=https://api.example.com/results.json</code></td>
                  </tr>
                  <tr>
                    <td><code>status</code></td>
                    <td>Initial status filter</td>
                    <td>all, pass, fail, skip, error</td>
                    <td><code>?status=fail</code></td>
                  </tr>
                  <tr>
                    <td><code>search</code></td>
                    <td>Initial search term</td>
                    <td>Any text string</td>
                    <td><code>?search=arithmetic</code></td>
                  </tr>
                  <tr>
                    <td><code>groupBy</code></td>
                    <td>Initial grouping option</td>
                    <td>none, group, status, testsName</td>
                    <td><code>?groupBy=group</code></td>
                  </tr>
                  <tr>
                    <td><code>sortBy</code></td>
                    <td>Initial sorting field</td>
                    <td>name, group, status, expression, testsName</td>
                    <td><code>?sortBy=name</code></td>
                  </tr>
                  <tr>
                    <td><code>sortOrder</code></td>
                    <td>Initial sort order</td>
                    <td>asc, desc</td>
                    <td><code>?sortOrder=desc</code></td>
                  </tr>
                  <tr>
                    <td><code>index</code></td>
                    <td>URL to an index JSON file</td>
                    <td>Valid HTTP/HTTPS URL to index.json</td>
                    <td><code>?index=https://api.example.com/index.json</code></td>
                  </tr>
                </tbody>
              </table>

              <h3>Combined Usage Examples</h3>
              <div class="mb-3">
                <h4>Load results and filter to failed tests:</h4>
                <code>?url=https://api.example.com/results.json&status=fail</code>
              </div>

              <div class="mb-3">
                <h4>Load results and search for specific tests:</h4>
                <code>?url=https://api.example.com/results.json&search=arithmetic</code>
              </div>

              <div class="mb-3">
                <h4>Load results with both status and search filters:</h4>
                <code>?url=https://api.example.com/results.json&status=error&search=division</code>
              </div>

              <div class="mb-3">
                <h4>Load results grouped by test group and sorted by name:</h4>
                <code>?url=https://api.example.com/results.json&groupBy=group&sortBy=name&sortOrder=asc</code>
              </div>

              <div class="mb-3">
                <h4>Load failed tests grouped by status and sorted by expression:</h4>
                <code>?url=https://api.example.com/results.json&status=fail&groupBy=status&sortBy=expression&sortOrder=desc</code>
              </div>

              <div class="mb-3">
                <h4>Complete example with all parameters:</h4>
                <code>?url=https://api.example.com/results.json&status=error&search=arithmetic&groupBy=group&sortBy=name&sortOrder=asc</code>
              </div>

              <div class="mb-3">
                <h4>Load from index file:</h4>
                <code>?index=https://api.example.com/index.json</code>
              </div>

              <div class="mb-3">
                <h4>Load from index with filters:</h4>
                <code>?index=https://api.example.com/index.json&status=fail&search=arithmetic</code>
              </div>
            </div>
          </div>
        </div>

        <!-- Index Files Tab -->
        <div class="tab-pane" [class.active]="activeTab === 'index-files'">
          <div class="card">
            <div class="card-header">
              <h2 class="h4 mb-0">Index File Support</h2>
            </div>
            <div class="card-body">
              <h3>Loading from Index Files</h3>
              <p>The application supports loading test results from index files, which contain a list of available result
                files. This is particularly useful for CI/CD systems that generate multiple test result files.</p>

              <h4>Index File Format</h4>
              <p>Index files must be valid JSON with a <code>files</code> array containing the available result file names:
              </p>
              <pre><code>{{ '{' }}
  "files": [
    "results-2024-01-15.json",
    "results-2024-01-16.json",
    "results-2024-01-17.json"
  ]
{{ '}' }}</code></pre>

              <h4>Using the Index Parameter</h4>
              <p>When you provide an <code>index</code> parameter, the application will:</p>
              <ol>
                <li>Load the index file from the specified URL</li>
                <li>Display a list of available result files</li>
                <li>Allow you to select and load any of the listed files</li>
                <li>Show a "Back to Home" menu option when viewing results loaded from an index</li>
              </ol>

              <h4>Index with Filter Parameters</h4>
              <p>You can combine the <code>index</code> parameter with filter parameters. When a user selects a file from
                the index, the filters will be automatically applied to the loaded results.</p>

              <div class="alert alert-info">
                <strong>Note:</strong> The "Back to Home" menu item only appears when viewing results that were loaded from
                an index file. This allows users to easily return to the index to select different result files.
              </div>
            </div>
          </div>
        </div>

        <!-- Integration & Deep Linking Tab -->
        <div class="tab-pane" [class.active]="activeTab === 'integration'">
          <div class="card">
            <div class="card-header">
              <h2 class="h4 mb-0">Programmatic Integration & Deep Linking</h2>
            </div>
            <div class="card-body">
              <h3>Deep Linking for CI/CD</h3>
              <p>Integrate the viewer into your continuous integration pipeline by generating direct links to filtered
                results. The application automatically updates the URL when users change controls, enabling easy sharing of
                specific views.</p>

              <h3>Real-time URL Synchronization</h3>
              <p>The application automatically updates the URL query parameters when users interact with controls:</p>
              <ul>
                <li><strong>Status Filter</strong> - Updates <code>status</code> parameter</li>
                <li><strong>Search Term</strong> - Updates <code>search</code> parameter</li>
                <li><strong>Grouping</strong> - Updates <code>groupBy</code> parameter</li>
                <li><strong>Sorting</strong> - Updates <code>sortBy</code> and <code>sortOrder</code> parameters</li>
              </ul>

              <div class="alert alert-info">
                <strong>Pro Tip:</strong> Bookmark URLs with specific filters for quick access to commonly used views, or
                share them in team communications for collaborative analysis. The complete URL including the data source can
                be shared and will load the exact same view.
              </div>
            </div>
          </div>
        </div>

        <!-- Schema Validation Tab -->
        <div class="tab-pane" [class.active]="activeTab === 'validation'">
          <div class="card">
            <div class="card-header">
              <h2 class="h4 mb-0">Schema Validation Details</h2>
            </div>
            <div class="card-body">
              <h3>Validation Rules</h3>
              <p>The application performs comprehensive validation against the CQL Test Results schema:</p>

              <h4>Required Fields Validation</h4>
              <ul>
                <li><code>cqlengine.apiUrl</code> - Must be a non-empty string</li>
                <li><code>testResultsSummary</code> - Must contain all count fields as numbers</li>
                <li><code>testsRunDateTime</code> - Must be a valid ISO 8601 date string</li>
                <li><code>results</code> - Must be an array of test result objects</li>
              </ul>

              <h4>Test Result Object Validation</h4>
              <ul>
                <li><code>testStatus</code> - Must be one of: pass, fail, skip, error</li>
                <li><code>testsName</code>, <code>groupName</code>, <code>testName</code>, <code>expression</code> -
                  Required strings</li>
                <li><code>invalid</code> - Must be one of: true, false, semantic (if present)</li>
                <li><code>responseStatus</code> - Must be a valid HTTP status code (if present)</li>
              </ul>

              <h3>Validation Error Handling</h3>
              <p>When validation fails, the application:</p>
              <ul>
                <li>Displays detailed error messages for each validation failure</li>
                <li>Still attempts to load the file for partial viewing</li>
                <li>Maintains filter functionality even with invalid data</li>
                <li>Provides guidance on fixing schema issues</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Filtering & Organization Tab -->
        <div class="tab-pane" [class.active]="activeTab === 'filtering'">
          <div class="card">
            <div class="card-header">
              <h2 class="h4 mb-0">Advanced Filtering & Organization</h2>
            </div>
            <div class="card-body">
              <h3>Search Capabilities</h3>
              <p>The search functionality performs case-insensitive matching across multiple fields:</p>
              <ul>
                <li><strong>Test Name</strong> - Exact and partial matches</li>
                <li><strong>Group Name</strong> - Category-based filtering</li>
                <li><strong>Test Suite Name</strong> - Suite-level organization</li>
                <li><strong>CQL Expression</strong> - Code content searching</li>
              </ul>

              <h3>Status Filter Combinations</h3>
              <p>Status filters work in combination with search terms:</p>
              <ul>
                <li>Search for "arithmetic" + filter by "fail" = Failed arithmetic tests only</li>
                <li>Search for "division" + filter by "error" = Division tests with errors only</li>
                <li>Search for "string" + filter by "pass" = Successful string operation tests only</li>
              </ul>

              <h3>Grouping & Sorting Features</h3>
              <p>The application provides powerful organization tools for large test result sets:</p>

              <h4>Grouping Options</h4>
              <ul>
                <li><strong>None</strong> - Display all results in a single list</li>
                <li><strong>Group Name</strong> - Group tests by their category/group</li>
                <li><strong>Status</strong> - Group tests by pass/fail/skip/error status</li>
                <li><strong>Tests Name</strong> - Group tests by their test suite name</li>
              </ul>

              <h4>Sorting Options</h4>
              <ul>
                <li><strong>Test Name</strong> - Alphabetical sorting by test name</li>
                <li><strong>Group Name</strong> - Alphabetical sorting by group name</li>
                <li><strong>Status</strong> - Sort by test status (pass, fail, skip, error)</li>
                <li><strong>Expression</strong> - Alphabetical sorting by CQL expression</li>
                <li><strong>Tests Name</strong> - Alphabetical sorting by test suite name</li>
              </ul>

              <h4>Sort Order</h4>
              <ul>
                <li><strong>Ascending</strong> - A-Z, 0-9, or status priority order</li>
                <li><strong>Descending</strong> - Z-A, 9-0, or reverse status priority order</li>
              </ul>

              <h3>URL Encoding for Special Characters</h3>
              <p>When using query parameters with special characters, ensure proper URL encoding:</p>
              <ul>
                <li>Spaces: <code>%20</code> or <code>+</code></li>
                <li>Special characters: Use percent encoding</li>
                <li>Unicode characters: UTF-8 encoding</li>
              </ul>
              <p><strong>Example:</strong> <code>?search=arithmetic%20operations&status=fail&groupBy=group</code></p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
